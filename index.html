<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Patrick Stanke Jump'n'Run</title>
<style>
  html, body {
    height: 100%;
    margin: 0;
    background: linear-gradient(to bottom, #121212, #1b1b30);
    color: #fff;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
    overflow: hidden;
  }
  #gameCanvas {
    display: block;
    margin: 0 auto;
    background: linear-gradient(to top, #222233, #444466);
    border: 4px solid #444;
    border-radius: 12px;
    touch-action: none;
  }
  #hud {
    position: fixed;
    top: 12px;
    left: 12px;
    font-weight: 700;
    font-size: 18px;
    user-select: none;
    z-index: 10;
    text-shadow: 1px 1px 3px #000;
  }
  #message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20,20,40,0.85);
    padding: 18px 28px;
    border-radius: 14px;
    font-size: 22px;
    font-weight: 700;
    color: #ffde59;
    text-align: center;
    display: none;
    z-index: 20;
    box-shadow: 0 0 15px #ffde59aa;
  }
  .ui {
    position: fixed;
    bottom: 10px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
    pointer-events: none;
    user-select: none;
  }
  .controls {
    pointer-events: auto;
    display: flex;
    gap: 14px;
  }
  .btn {
    width: 68px;
    height: 68px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.08);
    color: #fff;
    font-size: 28px;
    line-height: 68px;
    text-align: center;
    cursor: pointer;
    user-select: none;
    transition: background 0.2s ease;
    box-shadow: 0 0 6px #fff4;
  }
  .btn:active {
    background: rgba(255, 255, 255, 0.15);
    transform: scale(0.95);
    box-shadow: 0 0 12px #ffde59;
  }
  .btn.small {
    width: 56px;
    height: 56px;
    font-size: 22px;
    line-height: 56px;
  }
</style>
</head>
<body>
<div id="hud">Noten: <span id="score">0</span> / <span id="total">0</span></div>
<div id="message"></div>

<div class="ui">
  <div class="controls" style="margin-left:8px;">
    <div id="leftBtn" class="btn">◀</div>
    <div id="rightBtn" class="btn">▶</div>
  </div>
  <div class="controls" style="margin-right:8px;">
    <div id="jumpBtn" class="btn small">↑</div>
  </div>
</div>

<canvas id="gameCanvas" width="900" height="540" tabindex="0"></canvas>

<script>
/* -- CONFIG -- */
const GAME_WIDTH = 900;
const GAME_HEIGHT = 540;
const GRAVITY = 2200;
const MOVE_SPEED = 340;
const JUMP_SPEED = 780;
const NOTE_COUNT = 8;

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.focus();

/* -- SCALE CANVAS TO WINDOW -- */
function resizeCanvas() {
  const ratio = GAME_WIDTH / GAME_HEIGHT;
  let w = window.innerWidth;
  let h = window.innerHeight;
  if (h < w / ratio) {
    canvas.style.width = Math.min(w, GAME_WIDTH) + 'px';
    canvas.style.height = (canvas.clientWidth / ratio) + 'px';
  } else {
    canvas.style.height = Math.min(h * 0.78, GAME_HEIGHT) + 'px';
    canvas.style.width = (canvas.clientHeight * ratio) + 'px';
  }
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

/* -- INPUT -- */
let input = { left:false, right:false, jump:false };

function setupControls() {
  const leftBtn = document.getElementById('leftBtn');
  const rightBtn = document.getElementById('rightBtn');
  const jumpBtn = document.getElementById('jumpBtn');

  [[leftBtn, 'left'], [rightBtn, 'right'], [jumpBtn, 'jump']].forEach(([el, act]) => {
    el.addEventListener('touchstart', e => { e.preventDefault(); input[act] = true; });
    el.addEventListener('touchend', e => { e.preventDefault(); input[act] = false; });
    el.addEventListener('mousedown', e => { e.preventDefault(); input[act] = true; });
    el.addEventListener('mouseup', e => { e.preventDefault(); input[act] = false; });
    el.addEventListener('mouseleave', e => { input[act] = false; });
  });

  window.addEventListener('keydown', e => {
    if (e.repeat) return;
    if (e.code === 'ArrowLeft' || e.key === 'a') input.left = true;
    if (e.code === 'ArrowRight' || e.key === 'd') input.right = true;
    if (e.code === 'Space' || e.code === 'ArrowUp' || e.key === 'w') input.jump = true;
  });
  window.addEventListener('keyup', e => {
    if (e.code === 'ArrowLeft' || e.key === 'a') input.left = false;
    if (e.code === 'ArrowRight' || e.key === 'd') input.right = false;
    if (e.code === 'Space' || e.code === 'ArrowUp' || e.key === 'w') input.jump = false;
  });
}
setupControls();

/* -- GAME WORLD -- */
const platforms = [
  {x:0, y:GAME_HEIGHT-60, w:GAME_WIDTH, h:60},
  {x:50, y:GAME_HEIGHT-160, w:180, h:18},
  {x:280, y:GAME_HEIGHT-230, w:260, h:20},
  {x:600, y:GAME_HEIGHT-320, w:180, h:20},
  {x:820, y:GAME_HEIGHT-380, w:70, h:20},
  {x:450, y:GAME_HEIGHT-120, w:110, h:18},
  {x:150, y:GAME_HEIGHT-300, w:130, h:18},
  {x:740, y:GAME_HEIGHT-180, w:140, h:20}
];

let notes = [];
function spawnNotes() {
  notes = [];
  const positions = [
    {x:110, y:GAME_HEIGHT-210},
    {x:350, y:GAME_HEIGHT-280},
    {x:670, y:GAME_HEIGHT-350},
    {x:860, y:GAME_HEIGHT-400},
    {x:510, y:GAME_HEIGHT-140},
    {x:200, y:GAME_HEIGHT-340},
    {x:800, y:GAME_HEIGHT-210},
    {x:420, y:GAME_HEIGHT-280},
  ];
  for (let i = 0; i < Math.min(NOTE_COUNT, positions.length); i++) {
    notes.push({x: positions[i].x, y: positions[i].y, r: 20, collected: false});
  }
}
spawnNotes();
document.getElementById('total').innerText = notes.length;

/* -- PLAYER -- */
const player = {
  x: 70,
  y: GAME_HEIGHT - 200,
  w: 50,
  h: 90,
  vx: 0,
  vy: 0,
  grounded: false,
  facing: 1,
  canJump: true,
  jumpBuffer: 0
};

/* -- COLLISIONS -- */
function rectsOverlap(a,b){
  return !(a.x + a.w < b.x || a.x > b.x + b.w || a.y + a.h < b.y || a.y > b.y + b.h);
}

/* -- MESSAGE -- */
let msgTimer = null;
function showMessage(text) {
  const m = document.getElementById('message');
  m.style.display = 'block';
  m.innerText = text;
  if (msgTimer) clearTimeout(msgTimer);
  msgTimer = setTimeout(() => { m.style.display = 'none'; }, 3500);
}
function flashMessage(text) {
  showMessage(text);
}

/* -- GAME LOOP -- */
let lastTime = null;
let score = 0;
const scoreEl = document.getElementById('score');

function gameStep(ts) {
  if (!lastTime) lastTime = ts;
  const dt = Math.min((ts - lastTime) / 1000, 0.05);
  lastTime = ts;

  update(dt);
  render();

  requestAnimationFrame(gameStep);
}
requestAnimationFrame
